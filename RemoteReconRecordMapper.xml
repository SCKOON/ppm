<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kd.ppms_email.mapper.RemoteReconRecordMapper">
  <!--<resultMap id="BaseResultMap" type="com.kd.ppms_email.entity.RemoteReconRecord">-->
    <!--&lt;!&ndash;-->
      <!--WARNING - @mbg.generated-->
      <!--This element is automatically generated by MyBatis Generator, do not modify.-->
      <!--This element was generated on Fri Jun 15 15:22:01 GMT+08:00 2018.-->
    <!--&ndash;&gt;-->
    <!--<id column="id" jdbcType="INTEGER" property="id" />-->
    <!--<result column="TXN_ID" jdbcType="VARCHAR" property="txnId" />-->
    <!--<result column="TXN_TYPE" jdbcType="VARCHAR" property="txnType" />-->
    <!--<result column="GEN_TIME" jdbcType="TIMESTAMP" property="genTime" />-->
    <!--<result column="ACC_NO" jdbcType="VARCHAR" property="accNo" />-->
    <!--<result column="MAC_ID" jdbcType="VARCHAR" property="macId" />-->
    <!--<result column="METER_ID" jdbcType="VARCHAR" property="meterId" />-->
    <!--<result column="OPER_STATUS" jdbcType="VARCHAR" property="operStatus" />-->
    <!--<result column="OPER_TIME" jdbcType="TIMESTAMP" property="operTime" />-->
    <!--<result column="OPER_TIMES" jdbcType="INTEGER" property="operTimes" />-->
    <!--<result column="EXE_START_TIME" jdbcType="TIMESTAMP" property="exeStartTime" />-->
    <!--<result column="EXE_END_TIME" jdbcType="TIMESTAMP" property="exeEndTime" />-->
    <!--<result column="CTL_STATUS" jdbcType="VARCHAR" property="ctlStatus" />-->
    <!--<result column="METER_CON_STATUS" jdbcType="VARCHAR" property="meterConStatus" />-->
    <!--<result column="CTL_TIME" jdbcType="TIMESTAMP" property="ctlTime" />-->
    <!--<result column="DEL_FLAG" jdbcType="VARCHAR" property="delFlag" />-->
    <!--<result column="JOB_ID" jdbcType="VARCHAR" property="jobId" />-->
    <!--<result column="EMAIL_ID" jdbcType="INTEGER" property="emailId" />-->
  <!--</resultMap>-->
  <sql id="Base_Column_List">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jun 15 15:22:01 GMT+08:00 2018.
    -->
    id, TXN_ID, TXN_TYPE, GEN_TIME, ACC_NO, MAC_ID, METER_ID, OPER_STATUS, OPER_TIME, 
    OPER_TIMES, EXE_START_TIME, EXE_END_TIME, CTL_STATUS, METER_CON_STATUS, CTL_TIME, 
    DEL_FLAG, JOB_ID, EMAIL_ID
  </sql>
  <select id="selectByPrimaryKey" parameterType="java.lang.Integer" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jun 15 15:22:01 GMT+08:00 2018.
    -->
    select 
    <include refid="Base_Column_List" />
    from REMOTE_RECON_REC
    where id = #{id,jdbcType=INTEGER}
  </select>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.Integer">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jun 15 15:22:01 GMT+08:00 2018.
    -->
    delete from REMOTE_RECON_REC
    where id = #{id,jdbcType=INTEGER}
  </delete>
  <insert id="insert" parameterType="com.kd.ppms_email.entity.RemoteReconRecord">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jun 15 15:22:01 GMT+08:00 2018.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
      SELECT SCOPE_IDENTITY()
    </selectKey>
    insert into REMOTE_RECON_REC (TXN_ID, TXN_TYPE, GEN_TIME, 
      ACC_NO, MAC_ID, METER_ID, 
      OPER_STATUS, OPER_TIME, OPER_TIMES, 
      EXE_START_TIME, EXE_END_TIME, CTL_STATUS, 
      METER_CON_STATUS, CTL_TIME, DEL_FLAG, 
      JOB_ID, EMAIL_ID)
    values (#{txnId,jdbcType=VARCHAR}, #{txnType,jdbcType=VARCHAR}, #{genTime,jdbcType=TIMESTAMP}, 
      #{accNo,jdbcType=VARCHAR}, #{macId,jdbcType=VARCHAR}, #{meterId,jdbcType=VARCHAR}, 
      #{operStatus,jdbcType=VARCHAR}, #{operTime,jdbcType=TIMESTAMP}, #{operTimes,jdbcType=INTEGER}, 
      #{exeStartTime,jdbcType=TIMESTAMP}, #{exeEndTime,jdbcType=TIMESTAMP}, #{ctlStatus,jdbcType=VARCHAR}, 
      #{meterConStatus,jdbcType=VARCHAR}, #{ctlTime,jdbcType=TIMESTAMP}, #{delFlag,jdbcType=VARCHAR}, 
      #{jobId,jdbcType=VARCHAR}, #{emailId,jdbcType=INTEGER})
  </insert>
  <insert id="insertSelective" parameterType="com.kd.ppms_email.entity.RemoteReconRecord">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jun 15 15:22:01 GMT+08:00 2018.
    -->
    <selectKey keyProperty="id" order="AFTER" resultType="java.lang.Integer">
      SELECT SCOPE_IDENTITY()
    </selectKey>
    insert into REMOTE_RECON_REC
    <trim prefix="(" suffix=")" suffixOverrides=",">
      <if test="txnId != null">
        TXN_ID,
      </if>
      <if test="txnType != null">
        TXN_TYPE,
      </if>
      <if test="genTime != null">
        GEN_TIME,
      </if>
      <if test="accNo != null">
        ACC_NO,
      </if>
      <if test="macId != null">
        MAC_ID,
      </if>
      <if test="meterId != null">
        METER_ID,
      </if>
      <if test="operStatus != null">
        OPER_STATUS,
      </if>
      <if test="operTime != null">
        OPER_TIME,
      </if>
      <if test="operTimes != null">
        OPER_TIMES,
      </if>
      <if test="exeStartTime != null">
        EXE_START_TIME,
      </if>
      <if test="exeEndTime != null">
        EXE_END_TIME,
      </if>
      <if test="ctlStatus != null">
        CTL_STATUS,
      </if>
      <if test="meterConStatus != null">
        METER_CON_STATUS,
      </if>
      <if test="ctlTime != null">
        CTL_TIME,
      </if>
      <if test="delFlag != null">
        DEL_FLAG,
      </if>
      <if test="jobId != null">
        JOB_ID,
      </if>
      <if test="emailId != null">
        EMAIL_ID,
      </if>
    </trim>
    <trim prefix="values (" suffix=")" suffixOverrides=",">
      <if test="txnId != null">
        #{txnId,jdbcType=VARCHAR},
      </if>
      <if test="txnType != null">
        #{txnType,jdbcType=VARCHAR},
      </if>
      <if test="genTime != null">
        #{genTime,jdbcType=TIMESTAMP},
      </if>
      <if test="accNo != null">
        #{accNo,jdbcType=VARCHAR},
      </if>
      <if test="macId != null">
        #{macId,jdbcType=VARCHAR},
      </if>
      <if test="meterId != null">
        #{meterId,jdbcType=VARCHAR},
      </if>
      <if test="operStatus != null">
        #{operStatus,jdbcType=VARCHAR},
      </if>
      <if test="operTime != null">
        #{operTime,jdbcType=TIMESTAMP},
      </if>
      <if test="operTimes != null">
        #{operTimes,jdbcType=INTEGER},
      </if>
      <if test="exeStartTime != null">
        #{exeStartTime,jdbcType=TIMESTAMP},
      </if>
      <if test="exeEndTime != null">
        #{exeEndTime,jdbcType=TIMESTAMP},
      </if>
      <if test="ctlStatus != null">
        #{ctlStatus,jdbcType=VARCHAR},
      </if>
      <if test="meterConStatus != null">
        #{meterConStatus,jdbcType=VARCHAR},
      </if>
      <if test="ctlTime != null">
        #{ctlTime,jdbcType=TIMESTAMP},
      </if>
      <if test="delFlag != null">
        #{delFlag,jdbcType=VARCHAR},
      </if>
      <if test="jobId != null">
        #{jobId,jdbcType=VARCHAR},
      </if>
      <if test="emailId != null">
        #{emailId,jdbcType=INTEGER},
      </if>
    </trim>
  </insert>
  <update id="updateByPrimaryKeySelective" parameterType="com.kd.ppms_email.entity.RemoteReconRecord">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jun 15 15:22:01 GMT+08:00 2018.
    -->
    update REMOTE_RECON_REC
    <set>
      <if test="txnId != null">
        TXN_ID = #{txnId,jdbcType=VARCHAR},
      </if>
      <if test="txnType != null">
        TXN_TYPE = #{txnType,jdbcType=VARCHAR},
      </if>
      <if test="genTime != null">
        GEN_TIME = #{genTime,jdbcType=TIMESTAMP},
      </if>
      <if test="accNo != null">
        ACC_NO = #{accNo,jdbcType=VARCHAR},
      </if>
      <if test="macId != null">
        MAC_ID = #{macId,jdbcType=VARCHAR},
      </if>
      <if test="meterId != null">
        METER_ID = #{meterId,jdbcType=VARCHAR},
      </if>
      <if test="operStatus != null">
        OPER_STATUS = #{operStatus,jdbcType=VARCHAR},
      </if>
      <if test="operTime != null">
        OPER_TIME = #{operTime,jdbcType=TIMESTAMP},
      </if>
      <if test="operTimes != null">
        OPER_TIMES = #{operTimes,jdbcType=INTEGER},
      </if>
      <if test="exeStartTime != null">
        EXE_START_TIME = #{exeStartTime,jdbcType=TIMESTAMP},
      </if>
      <if test="exeEndTime != null">
        EXE_END_TIME = #{exeEndTime,jdbcType=TIMESTAMP},
      </if>
      <if test="ctlStatus != null">
        CTL_STATUS = #{ctlStatus,jdbcType=VARCHAR},
      </if>
      <if test="meterConStatus != null">
        METER_CON_STATUS = #{meterConStatus,jdbcType=VARCHAR},
      </if>
      <if test="ctlTime != null">
        CTL_TIME = #{ctlTime,jdbcType=TIMESTAMP},
      </if>
      <if test="delFlag != null">
        DEL_FLAG = #{delFlag,jdbcType=VARCHAR},
      </if>
      <if test="jobId != null">
        JOB_ID = #{jobId,jdbcType=VARCHAR},
      </if>
      <if test="emailId != null">
        EMAIL_ID = #{emailId,jdbcType=INTEGER},
      </if>
    </set>
    where id = #{id,jdbcType=INTEGER}
  </update>
  <update id="updateByPrimaryKey" parameterType="com.kd.ppms_email.entity.RemoteReconRecord">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Jun 15 15:22:01 GMT+08:00 2018.
    -->
    update REMOTE_RECON_REC
    set TXN_ID = #{txnId,jdbcType=VARCHAR},
      TXN_TYPE = #{txnType,jdbcType=VARCHAR},
      GEN_TIME = #{genTime,jdbcType=TIMESTAMP},
      ACC_NO = #{accNo,jdbcType=VARCHAR},
      MAC_ID = #{macId,jdbcType=VARCHAR},
      METER_ID = #{meterId,jdbcType=VARCHAR},
      OPER_STATUS = #{operStatus,jdbcType=VARCHAR},
      OPER_TIME = #{operTime,jdbcType=TIMESTAMP},
      OPER_TIMES = #{operTimes,jdbcType=INTEGER},
      EXE_START_TIME = #{exeStartTime,jdbcType=TIMESTAMP},
      EXE_END_TIME = #{exeEndTime,jdbcType=TIMESTAMP},
      CTL_STATUS = #{ctlStatus,jdbcType=VARCHAR},
      METER_CON_STATUS = #{meterConStatus,jdbcType=VARCHAR},
      CTL_TIME = #{ctlTime,jdbcType=TIMESTAMP},
      DEL_FLAG = #{delFlag,jdbcType=VARCHAR},
      JOB_ID = #{jobId,jdbcType=VARCHAR},
      EMAIL_ID = #{emailId,jdbcType=INTEGER}
    where id = #{id,jdbcType=INTEGER}
  </update>
  <resultMap id="BaseResultMap" type="com.kd.ppms_email.entity.RemoteReconRecord">
    <id column="id" jdbcType="INTEGER" property="id" />
    <result column="TXN_ID" jdbcType="VARCHAR" property="txnId" />
    <result column="TXN_TYPE" jdbcType="VARCHAR" property="txnType" />
    <result column="GEN_TIME" jdbcType="TIMESTAMP" property="genTime" />
    <result column="ACC_NO" jdbcType="VARCHAR" property="accNo" />
    <result column="MAC_ID" jdbcType="VARCHAR" property="macId" />
    <result column="METER_ID" jdbcType="VARCHAR" property="meterId" />
    <result column="OPER_STATUS" jdbcType="VARCHAR" property="operStatus" />
    <result column="OPER_TIME" jdbcType="TIMESTAMP" property="operTime" />
    <result column="OPER_TIMES" jdbcType="INTEGER" property="operTimes" />
    <result column="EXE_START_TIME" jdbcType="TIMESTAMP" property="exeStartTime" />
    <result column="EXE_END_TIME" jdbcType="TIMESTAMP" property="exeEndTime" />
    <result column="CTL_STATUS" jdbcType="VARCHAR" property="ctlStatus" />
    <result column="METER_CON_STATUS" jdbcType="VARCHAR" property="meterConStatus" />
    <result column="CTL_TIME" jdbcType="TIMESTAMP" property="ctlTime" />
    <result column="DEL_FLAG" jdbcType="VARCHAR" property="delFlag" />
    <result column="JOB_ID" jdbcType="VARCHAR" property="jobId" />
    <result column="EMAIL_ID" jdbcType="INTEGER" property="emailId" />
    <association javaType="com.kd.ppms_email.entity.CustomerInfo" property="customerInfo">
      <result column="ADDRESS" jdbcType="VARCHAR" property="address" />
    </association>
    <association javaType="com.kd.ppms_email.entity.AccountBalanceEntity" property="accountBalance">
      <result column="BALANCE" jdbcType="VARCHAR" property="balance" />
    </association>
  </resultMap>

  <select id="queryToEmailByDate" resultMap="BaseResultMap">
    Select a.id as id, a.acc_no AS ACC_NO, a.METER_ID AS METER_ID, a.CTL_TIME AS CTL_TIME, d.balance AS balance, c.address AS ADDRESS
    from remote_recon_rec a , remote_provisioning_job b , A_CUSTOMER_INFO c,A_ACCT_BAL d
    where a.job_id = b.job_id
    AND a.oper_status = #{operStatus,jdbcType=VARCHAR} AND a.ctl_status = #{ctlStatus,jdbcType=VARCHAR} AND b.job_status= #{jobStatus,jdbcType=VARCHAR}
    AND a.acc_no = c.acc_no and c.acc_no = d.acc_no and a.EMAIL_ID IS NULL
    <!--AND CTL_TIME>= CONVERT(datetime,CONVERT(varchar(100), #{date}, 23))-->
    <!--<![CDATA[ AND CTL_TIME< dateadd(day,1,CONVERT(varchar(100), #{date}, 23))]]>-->
  </select>
  <select id="queryEmailCondition" resultType="java.lang.String">
    Select DISTINCT CONVERT(varchar(100), CTL_TIME, 23)
    FROM remote_recon_rec a , remote_provisioning_job b
    where a.job_id = b.job_id
    AND a.oper_status = #{operStatus,jdbcType=VARCHAR} AND a.ctl_status = #{ctlStatus,jdbcType=VARCHAR} AND b.job_status= #{jobStatus,jdbcType=VARCHAR}
    AND a.EMAIL_ID IS NULL
    GROUP BY CONVERT(varchar(100), CTL_TIME, 23)
  </select>
  <update id="batchUpdateByMap" parameterType="java.util.Map">
        UPDATE REMOTE_RECON_REC
    <trim prefix="set" suffixOverrides=",">
      <if test="emailId != null">
            EMAIL_ID = #{emailId} ,
      </if>
    </trim>
    WHERE id IN
        <foreach close=")" collection="idList" index="index" item="item" open="(" separator=",">
            #{item.id}
        </foreach>
  </update>
</mapper>
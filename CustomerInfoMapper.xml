<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sp.ppms.console.dao.CustomerInfoMapper">
  <resultMap id="BaseResultMap" type="com.sp.ppms.console.domain.CustomerInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat May 19 13:34:44 CST 2018.
    -->
    <id column="acc_no" jdbcType="VARCHAR" property="accNo" />
    <result column="name" jdbcType="VARCHAR" property="name" />
    <result column="nric" jdbcType="VARCHAR" property="nric" />
    <result column="installation_no" jdbcType="VARCHAR" property="installationNo" />
    <result column="salutation" jdbcType="VARCHAR" property="salutation" />
    <result column="address" jdbcType="VARCHAR" property="address" />
    <result column="premise_type" jdbcType="VARCHAR" property="premiseType" />
    <result column="block_number" jdbcType="VARCHAR" property="blockNumber" />
    <result column="street_name" jdbcType="VARCHAR" property="streetName" />
    <result column="unit_number" jdbcType="VARCHAR" property="unitNumber" />
    <result column="postal_code" jdbcType="VARCHAR" property="postalCode" />
    <result column="mail_addr" jdbcType="VARCHAR" property="mailAddr" />
    <result column="email_addr" jdbcType="VARCHAR" property="emailAddr" />
    <result column="telephone_number" jdbcType="VARCHAR" property="telephoneNumber" />
    <result column="fax_number" jdbcType="VARCHAR" property="faxNumber" />
    <result column="mobile_number" jdbcType="VARCHAR" property="mobileNumber" />
    <result column="tariff_code" jdbcType="VARCHAR" property="tariffCode" />
    <result column="gst_code" jdbcType="VARCHAR" property="gstCode" />
    <result column="preset_credit" jdbcType="NUMERIC" property="presetCredit" />
    <result column="emergency_credit" jdbcType="NUMERIC" property="emergencyCredit" />
    <result column="emergency_state" jdbcType="VARCHAR" property="emergencyState" />
    <result column="low_credit_alarm" jdbcType="NUMERIC" property="lowCreditAlarm" />
    <result column="disconnect_alarm" jdbcType="NUMERIC" property="disconnectAlarm" />
    <result column="account_status" jdbcType="VARCHAR" property="accountStatus" />
    <result column="open_date" jdbcType="TIMESTAMP" property="openDate" />
    <result column="sheduled_activation_date" jdbcType="TIMESTAMP" property="sheduledActivationDate" />
    <result column="activation_date" jdbcType="TIMESTAMP" property="activationDate" />
    <result column="close_date" jdbcType="TIMESTAMP" property="closeDate" />
    <result column="init_reads" jdbcType="NUMERIC" property="initReads" />
    <result column="final_reads" jdbcType="NUMERIC" property="finalReads" />
    <result column="type" jdbcType="VARCHAR" property="type" />
    <result column="del_flag" jdbcType="VARCHAR" property="delFlag" />
    <result column="arrear_pct" jdbcType="NUMERIC" property="arrearPct" />
    <result column="ebs_activation_notify" jdbcType="VARCHAR" property="ebsActivationNotify" />
    <result column="install_date" jdbcType="TIMESTAMP" property="installDate" />
    <result column="meter_id" jdbcType="VARCHAR" property="meterId" />
    <result column="meter_status" jdbcType="VARCHAR" property="meterStatus" />

  </resultMap>
  <delete id="deleteByPrimaryKey" parameterType="java.lang.String">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat May 19 13:34:44 CST 2018.
    -->
    delete from A_CUSTOMER_INFO
    where acc_no = #{accNo,jdbcType=VARCHAR}
  </delete>
  <insert id="insert" parameterType="com.sp.ppms.console.domain.CustomerInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat May 19 13:34:44 CST 2018.
    -->
    insert into A_CUSTOMER_INFO (acc_no, name, nric, 
      installation_no, salutation, address, 
      premise_type, block_number, street_name, 
      unit_number, postal_code, mail_addr, 
      email_addr, telephone_number, fax_number, 
      mobile_number, tariff_code, gst_code, 
      preset_credit, emergency_credit, emergency_state, 
      low_credit_alarm, disconnect_alarm, account_status, 
      open_date, sheduled_activation_date, activation_date, 
      close_date, init_reads, final_reads, 
      type, del_flag, arrear_pct, 
      ebs_activation_notify)
    values (#{accNo,jdbcType=VARCHAR}, #{name,jdbcType=VARCHAR}, #{nric,jdbcType=VARCHAR}, 
      #{installationNo,jdbcType=VARCHAR}, #{salutation,jdbcType=VARCHAR}, #{address,jdbcType=VARCHAR}, 
      #{premiseType,jdbcType=VARCHAR}, #{blockNumber,jdbcType=VARCHAR}, #{streetName,jdbcType=VARCHAR}, 
      #{unitNumber,jdbcType=VARCHAR}, #{postalCode,jdbcType=VARCHAR}, #{mailAddr,jdbcType=VARCHAR}, 
      #{emailAddr,jdbcType=VARCHAR}, #{telephoneNumber,jdbcType=VARCHAR}, #{faxNumber,jdbcType=VARCHAR}, 
      #{mobileNumber,jdbcType=VARCHAR}, #{tariffCode,jdbcType=VARCHAR}, #{gstCode,jdbcType=VARCHAR}, 
      #{presetCredit,jdbcType=NUMERIC}, #{emergencyCredit,jdbcType=NUMERIC}, #{emergencyState,jdbcType=VARCHAR}, 
      #{lowCreditAlarm,jdbcType=NUMERIC}, #{disconnectAlarm,jdbcType=NUMERIC}, #{accountStatus,jdbcType=VARCHAR}, 
      #{openDate,jdbcType=TIMESTAMP}, #{sheduledActivationDate,jdbcType=TIMESTAMP}, #{activationDate,jdbcType=TIMESTAMP}, 
      #{closeDate,jdbcType=TIMESTAMP}, #{initReads,jdbcType=NUMERIC}, #{finalReads,jdbcType=NUMERIC}, 
      #{type,jdbcType=VARCHAR}, #{delFlag,jdbcType=VARCHAR}, #{arrearPct,jdbcType=NUMERIC}, 
      #{ebsActivationNotify,jdbcType=VARCHAR})
  </insert>
  <update id="updateByPrimaryKey" parameterType="com.sp.ppms.console.domain.CustomerInfo">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat May 19 13:34:44 CST 2018.
    -->
    update A_CUSTOMER_INFO
    set name = #{name,jdbcType=VARCHAR},
      nric = #{nric,jdbcType=VARCHAR},
      installation_no = #{installationNo,jdbcType=VARCHAR},
      salutation = #{salutation,jdbcType=VARCHAR},
      address = #{address,jdbcType=VARCHAR},
      premise_type = #{premiseType,jdbcType=VARCHAR},
      block_number = #{blockNumber,jdbcType=VARCHAR},
      street_name = #{streetName,jdbcType=VARCHAR},
      unit_number = #{unitNumber,jdbcType=VARCHAR},
      postal_code = #{postalCode,jdbcType=VARCHAR},
      mail_addr = #{mailAddr,jdbcType=VARCHAR},
      email_addr = #{emailAddr,jdbcType=VARCHAR},
      telephone_number = #{telephoneNumber,jdbcType=VARCHAR},
      fax_number = #{faxNumber,jdbcType=VARCHAR},
      mobile_number = #{mobileNumber,jdbcType=VARCHAR},
      tariff_code = #{tariffCode,jdbcType=VARCHAR},
      gst_code = #{gstCode,jdbcType=VARCHAR},
      preset_credit = #{presetCredit,jdbcType=NUMERIC},
      emergency_credit = #{emergencyCredit,jdbcType=NUMERIC},
      emergency_state = #{emergencyState,jdbcType=VARCHAR},
      low_credit_alarm = #{lowCreditAlarm,jdbcType=NUMERIC},
      disconnect_alarm = #{disconnectAlarm,jdbcType=NUMERIC},
      account_status = #{accountStatus,jdbcType=VARCHAR},
      open_date = #{openDate,jdbcType=TIMESTAMP},
      sheduled_activation_date = #{sheduledActivationDate,jdbcType=TIMESTAMP},
      activation_date = #{activationDate,jdbcType=TIMESTAMP},
      close_date = #{closeDate,jdbcType=TIMESTAMP},
      init_reads = #{initReads,jdbcType=NUMERIC},
      final_reads = #{finalReads,jdbcType=NUMERIC},
      type = #{type,jdbcType=VARCHAR},
      del_flag = #{delFlag,jdbcType=VARCHAR},
      arrear_pct = #{arrearPct,jdbcType=NUMERIC},
      ebs_activation_notify = #{ebsActivationNotify,jdbcType=VARCHAR}
    where acc_no = #{accNo,jdbcType=VARCHAR}
  </update>
  <select id="selectByPrimaryKey" parameterType="java.lang.String" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat May 19 13:34:44 CST 2018.
    -->
    select acc_no, name, nric, installation_no, salutation, address, premise_type, block_number, 
    street_name, unit_number, postal_code, mail_addr, email_addr, telephone_number, fax_number, 
    mobile_number, tariff_code, gst_code, preset_credit, emergency_credit, emergency_state, 
    low_credit_alarm, disconnect_alarm, account_status, open_date, sheduled_activation_date, 
    activation_date, close_date, init_reads, final_reads, type, del_flag, arrear_pct, 
    ebs_activation_notify
    from A_CUSTOMER_INFO
    where acc_no = #{accNo,jdbcType=VARCHAR}
  </select>
  <select id="selectAll" resultMap="BaseResultMap">
    <!--
      WARNING - @mbg.generated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Sat May 19 13:34:44 CST 2018.
    -->
    select acc_no, name, nric, installation_no, salutation, address, premise_type, block_number, 
    street_name, unit_number, postal_code, mail_addr, email_addr, telephone_number, fax_number, 
    mobile_number, tariff_code, gst_code, preset_credit, emergency_credit, emergency_state, 
    low_credit_alarm, disconnect_alarm, account_status, open_date, sheduled_activation_date, 
    activation_date, close_date, init_reads, final_reads, type, del_flag, arrear_pct, 
    ebs_activation_notify
    from A_CUSTOMER_INFO
  </select>
  <select id="insertBatch">
    insert into A_CUSTOMER_INFO (acc_no)
            values
              <foreach collection="list" item="customerInfo" separator=",">
                (#{customerInfo.accNo,jdbcType=VARCHAR})
              </foreach>
  </select>
  <select id="getAll" resultType="java.util.HashMap">
    select acc_no from A_CUSTOMER_INFO
  </select>
  <!--20180627 add by yangyong-->
  <select id="getAllByDateAndStatus" parameterType="com.sp.ppms.console.domain.CustomerInfo" resultType="int">
    select activation_date from A_CUSTOMER_INFO  where  account_status = #{accountStatus,jdbcType=VARCHAR}
  </select>
  <!--获取未激活的账户-->
  <select id="getNotActivationAccNo" resultMap="BaseResultMap">
      SELECT
	    t.address,
	    t.acc_no,
        t.open_date,
        t.sheduled_activation_date,
	    b.install_date,
	    b.meter_id,
	    b.meter_status
      FROM
	    A_CUSTOMER_INFO t
        JOIN A_METER_INFO b ON t.acc_no = b.acc_no
      WHERE
    t.sheduled_activation_date &gt;= CAST(CONVERT (
    VARCHAR (10),
    DATEADD(DAY,  1, GETDATE()),
    120
    )+' 00:00:00' as datetime)
    and  t.sheduled_activation_date &lt; =CAST(CONVERT (
    VARCHAR (10),
    DATEADD(DAY,  1, GETDATE()),
    120
    )+' 23:59:59' as datetime)
    AND (t.activation_date IS NULL or t.activation_date ='')
  </select>
  <select id="selectByStatus" resultMap="BaseResultMap">
    select acc_no, name, nric, installation_no, salutation, address, premise_type, block_number,
      street_name, unit_number, postal_code, mail_addr, email_addr, telephone_number, fax_number,
      mobile_number, tariff_code, gst_code, preset_credit, emergency_credit, emergency_state,
      low_credit_alarm, disconnect_alarm, account_status, open_date, sheduled_activation_date,
      activation_date, close_date, init_reads, final_reads, type, del_flag, arrear_pct,
      ebs_activation_notify
    from A_CUSTOMER_INFO
    where acc_no not in (select acc_no from A_METER_INFO)
    and account_status = #{status}
  </select>
  <select id="selectActivationAcc" resultMap="BaseResultMap">
    select acc_no, name, nric, installation_no, salutation, address, premise_type, block_number,
      street_name, unit_number, postal_code, mail_addr, email_addr, telephone_number, fax_number,
      mobile_number, tariff_code, gst_code, preset_credit, emergency_credit, emergency_state,
      low_credit_alarm, disconnect_alarm, account_status, open_date, sheduled_activation_date,
      activation_date, close_date, init_reads, final_reads, type, del_flag, arrear_pct,
      ebs_activation_notify
    from A_CUSTOMER_INFO
    where account_status = #{accountStatus}
  </select>
  <select id="selectByAccNo"  parameterType="java.lang.String" resultType="java.util.Map">
      select a.activation_date as date,b.BALANCE as balance,a.emergency_credit as emergencyCredit
    from A_CUSTOMER_INFO a left join  A_ACCT_BAL b on a.acc_no = b.acc_no
    where a.acc_no = #{accNo}
  </select>
  <select id="selectActivation" resultType="java.util.Map" >
    select a.*,b.meter_id
    from A_CUSTOMER_INFO a,a_meter_info b
    where a.acc_no = b.acc_no
    and a.account_status = #{accStatus}
    and b.meter_status = #{meterStatus}
    and ( a.ebs_activation_notify = #{activationStatus}
    or a.ebs_activation_notify is null )
  </select>
  <update id="updateByStatus">
    update A_CUSTOMER_INFO set account_status = #{accStatus}
    from ( select a.* from A_CUSTOMER_INFO a ,A_METER_INFO b
    where a.acc_no = b.acc_no and b.meter_id is not NULL
          and a.account_status = #{status}
         )c where A_CUSTOMER_INFO.acc_no = c.acc_no
  </update>
</mapper>